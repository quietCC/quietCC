<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Flink-Windowså‡½æ•° | æŠšä»Šäºº</title><meta name="keywords" content="Flink"><meta name="author" content="æŠšä»Šäºº"><meta name="copyright" content="æŠšä»Šäºº"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Apache Flinkæ˜¯ä¸€ä¸ªæ¡†æ¶å’Œåˆ†å¸ƒå¼å¤„ç†å¼•æ“, å¯¹äºæœ‰ç•Œæµå’Œæ— ç•Œæµè¿›è¡ŒçŠ¶æ€è®¡ç®—.">
<meta property="og:type" content="article">
<meta property="og:title" content="Flink-Windowså‡½æ•°">
<meta property="og:url" content="http://example.com/2010/12/12/Flink-Windows%E5%87%BD%E6%95%B0/index.html">
<meta property="og:site_name" content="æŠšä»Šäºº">
<meta property="og:description" content="Apache Flinkæ˜¯ä¸€ä¸ªæ¡†æ¶å’Œåˆ†å¸ƒå¼å¤„ç†å¼•æ“, å¯¹äºæœ‰ç•Œæµå’Œæ— ç•Œæµè¿›è¡ŒçŠ¶æ€è®¡ç®—.">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/quietCC/imageBed/img/613932.png">
<meta property="article:published_time" content="2010-12-11T16:00:00.000Z">
<meta property="article:modified_time" content="2021-11-19T07:23:45.121Z">
<meta property="article:author" content="æŠšä»Šäºº">
<meta property="article:tag" content="Flink">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/quietCC/imageBed/img/613932.png"><link rel="shortcut icon" href="/img/avatar.png"><link rel="canonical" href="http://example.com/2010/12/12/Flink-Windows%E5%87%BD%E6%95%B0/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'å¤©',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"ä½ å·²åˆ‡æ¢ä¸ºç¹ä½“","cht_to_chs":"ä½ å·²åˆ‡æ¢ä¸ºç®€ä½“","day_to_night":"ä½ å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼","night_to_day":"ä½ å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼","bgLight":"#49b1f5","bgDark":"#121212","position":"top-center"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-11-19 15:23:45'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><script src="https://myhkw.cn/player/js/jquery.min.js" type="text/javascript"></script><link rel="stylesheet" href="/css/icon.css" media="defer" onload="this.media='all'"/><link rel="stylesheet" href="/css/custom.css"/><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">49</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">36</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">8</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/index.html"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> ç±»åˆ«</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> å¨±ä¹</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> ç…§ç‰‡</span></a></li><li><a class="site-page" href="/cinemas/"><i class="fa-fw fas fa-video"></i><span> ç”µå½±</span></a></li><li><a class="site-page" href="/bangumis/"><i class="fa-fw fas fa-video"></i><span> è¿½ç•ª</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/quietCC/imageBed/img/613932.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">æŠšä»Šäºº</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/index.html"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> ç±»åˆ«</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> å¨±ä¹</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> ç…§ç‰‡</span></a></li><li><a class="site-page" href="/cinemas/"><i class="fa-fw fas fa-video"></i><span> ç”µå½±</span></a></li><li><a class="site-page" href="/bangumis/"><i class="fa-fw fas fa-video"></i><span> è¿½ç•ª</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Flink-Windowså‡½æ•°</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2010-12-11T16:00:00.000Z" title="å‘è¡¨äº 2010-12-12 00:00:00">2010-12-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2021-11-19T07:23:45.121Z" title="æ›´æ–°äº 2021-11-19 15:23:45">2021-11-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">å¤§æ•°æ®</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>å‚è€ƒå¼•ç”¨é“¾æ¥: </p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/legendtkl/paper_reading/blob/main/realtime-compute/Chandy-Lamport.md">åˆ†å¸ƒå¼å¿«ç…§ç®—æ³•: Chandy-Lamport</a></li>
<li>äº”åˆ†é’Ÿå­¦å¤§æ•°æ®å¾®ä¿¡å…¬ä¼—å·</li>
<li>å°šç¡…è°·å¤§æ•°æ®å­¦ä¹ æ–‡æ¡£</li>
<li>Flink1.13å®˜æ–¹æ–‡æ¡£</li>
</ul>
<h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><p>windows are at the heart of processing infinite streams. Windows split the stream into â€œbucketsâ€ of finite size, over which we can apply computations. This document focuses on how windowing is performed in Flink and how the programmer can benefit to the maximum from its offered functitonality.</p>
<p>The general structure if w windowed Flink program is presented below, The first snippet refers to keyed streams, while the second to non-keyed ones. As one can see, the only difference is the keyBy(â€¦) call for the keyed streams and the window(â€¦) which becomes windowAll(â€¦) for non-keyed streams, This is also going to serve as a roadmap for the rest of the page.</p>
<blockquote>
<p>windowsæ˜¯å¤„ç†æ— ç•Œæµçš„æ ¸å¿ƒ. windowså°†æµåˆ†æˆæœ‰é™å¤§å°çš„â€æ¡¶â€, æˆ‘ä»¬å¯ä»¥åœ¨è¿™äº›æ¡¶ä¸Šæ˜ ç”¨è®¡ç®—. æˆ‘ä»¬é‡ç‚¹ä»‹ç»å¦‚ä½•åœ¨Flinkä¸­æ‰§è¡Œçª—å£åŒ–ä»¥åŠç¨‹åºå‘˜å¦‚ä½•ä»å…¶æä¾›çš„åŠŸèƒ½ä¸­è·å¾—æœ€å¤§çš„æ”¶ç›Š</p>
<p>çª—å£åŒ–çš„Flinkçš„ç¨‹åºä¸€èˆ¬ç»“æ„å¦‚ä¸‹æ‰€ç¤º. ç¬¬ä¸€ä¸ªç‰‡æ®µæ˜¯æŒ‡ç›‘æ§æµ, ç¬¬äºŒä¸ªæŒ‡æ§çš„æ˜¯éé”®æ§æµ, å¦‚æ‚¨æ‰€è§, å”¯ä¸€çš„åŒºåˆ«æ˜¯keyBy(â€¦)å¯¹é”®æ§æµçš„è°ƒç”¨æ˜¯window, å¯¹äºéé”®æ§æµè°ƒç”¨çš„æ˜¯windowAll. è¿™ä¹Ÿå°†ä½œä¸ºé¡µé¢å…¶ä½™éƒ¨åˆ†çš„è·¯çº¿å›¾</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">stream</span><br><span class="line">       .keyBy(...)               &lt;-  keyed versus non-keyed windows</span><br><span class="line">       .window(...)              &lt;-  required: <span class="string">&quot;assigner&quot;</span></span><br><span class="line">      [.trigger(...)]            &lt;-  optional: <span class="string">&quot;trigger&quot;</span> (<span class="keyword">else</span> <span class="keyword">default</span> trigger)</span><br><span class="line">      [.evictor(...)]            &lt;-  optional: <span class="string">&quot;evictor&quot;</span> (<span class="keyword">else</span> no evictor)</span><br><span class="line">      [.allowedLateness(...)]    &lt;-  optional: <span class="string">&quot;lateness&quot;</span> (<span class="keyword">else</span> zero)</span><br><span class="line">      [.sideOutputLateData(...)] &lt;-  optional: <span class="string">&quot;output tag&quot;</span> (<span class="keyword">else</span> no side output <span class="keyword">for</span> late data)</span><br><span class="line">       .reduce/aggregate/apply()      &lt;-  required: <span class="string">&quot;function&quot;</span></span><br><span class="line">      [.getSideOutput(...)]      &lt;-  optional: <span class="string">&quot;output tag&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">stream</span><br><span class="line">       .windowAll(...)           &lt;-  required: <span class="string">&quot;assigner&quot;</span></span><br><span class="line">      [.trigger(...)]            &lt;-  optional: <span class="string">&quot;trigger&quot;</span> (<span class="keyword">else</span> <span class="keyword">default</span> trigger)</span><br><span class="line">      [.evictor(...)]            &lt;-  optional: <span class="string">&quot;evictor&quot;</span> (<span class="keyword">else</span> no evictor)</span><br><span class="line">      [.allowedLateness(...)]    &lt;-  optional: <span class="string">&quot;lateness&quot;</span> (<span class="keyword">else</span> zero)</span><br><span class="line">      [.sideOutputLateData(...)] &lt;-  optional: <span class="string">&quot;output tag&quot;</span> (<span class="keyword">else</span> no side output <span class="keyword">for</span> late data)</span><br><span class="line">       .reduce/aggregate/apply()      &lt;-  required: <span class="string">&quot;function&quot;</span></span><br><span class="line">      [.getSideOutput(...)]      &lt;-  optional: <span class="string">&quot;output tag&quot;</span></span><br></pre></td></tr></table></figure>

<p>In the above, the commands in square brackets ([â€¦]) are optional. This reveals that Flink allows you to customize your windowing logic in many different ways so that it best fits your needs.</p>
<blockquote>
<p>åœ¨ä¸Šé¢, æ–¹æ‹¬å·([â€¦])ä¸­çš„å‘½ä»¤æ˜¯å¯é€‰çš„, è¿™è¡¨æ˜Flinkå…è®¸æ‚¨ä»¥å¤šç§ä¸åŒçš„æ–¹å¼è‡ªå®šä¹‰çª—å£é€»è¾‘, ä½¿å…¶æœ€é€‚åˆæ‚¨çš„éœ€æ±‚.</p>
</blockquote>
<pre class="mermaid">graph LR
    subgraph bound1
        a[Event] --> b[Event] --> c[Event]
    end
    subgraph bound2
        c --> d[Event] --> e[Event] --> f[Event]
    end
    f --> g[Event] --> h[Event] --> ...</pre>

<h1 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h1><p>in a nutshell , a window is created as soon as the first element that should belong to this window arrives, and the window is conpletely removed when the time (even or processing time) passes its end timestamp plus the user-specified allowed lastness(see <a target="_blank" rel="noopener" href="https://nightlies.apache.org/flink/flink-docs-release-1.13/zh/docs/dev/datastream/operators/windows/#allowed-lateness">Allowed Lateness</a>). Flink guarantees removal only for time-based windows and not for other types, eg. global windows (see <a target="_blank" rel="noopener" href="https://nightlies.apache.org/flink/flink-docs-release-1.13/zh/docs/dev/datastream/operators/windows/#window-assigners">Window Assigners</a>). For Exemple , with an event-time-based windowing strategy that creates non-overlapping(or tumbling) windwos every 5 minutes and has an allowed lateness of 1 min, Flink will create a new window for the interval between 12:00 and 12:05 when the first element with a timestamp that falls into this interval arrives, and it will remove it when the watermark passes the 12:06 timestamp.</p>
<blockquote>
<p>ç®€è€Œè¨€ä¹‹, å½“åœ°ä¸€ä¸ªåº”è¯¥å±äºè¿™ä¸ªåˆ›å»ºå£çš„å…ƒç´ åˆ°è¾¾çš„æ—¶å€™, å°±ä¼šåˆ›å»ºä¸€ä¸ªçª—å£, è€Œå½“æ—¶é—´(äº‹ä»¶äº‹ä»¶æˆ–è€…å¤„ç†æ—¶é—´)è¶…è¿‡å…¶ç»“æŸæ—¶é—´æˆ³åŠ ä¸Šç”¨æˆ·æŒ‡å®šçš„å…è®¸å»¶è¿Ÿæ—¶, è¯¥çª—å£å°±ä¼šè¢«å®Œå…¨åˆ é™¤. Flinkåªä¿è¯åŸºäºæ—¶é—´çš„çª—å£çš„æº¢å‡º, è€Œä¸ä¿è¯å…¶ä»–çš„ç±»å‹, ä¾‹å¦‚å…¨å±€çª—å£. ä¾‹å¦‚, å¯¹äºä¸€ä¸ªåŸºäºäº‹ä»¶äº‹ä»¶çš„çª—å£ç­–ç•¥, æ¯äº”åˆ†é’Ÿåƒuæ˜‚å»ºä¸€ä¸ªä¸é‡å (æˆ–è€…ç¿»æ»š)çš„çª—å£, å¹¶ä¸”å…è®¸åˆ†é’Ÿçš„å»¶è¿Ÿ, å½“åœ°ä¸€ä¸ªè‚²æœ‰æ—¶é—´æˆ³çš„å…ƒç´ åˆ°è¾¾è¿™ä¸ªåŒºé—´çš„æ—¶å€™, Flinkå°†ä¸º12:00å’Œ12:05ä¹‹é—´çš„åŒºé—´åˆ›å»ºä¸€ä¸ªæ–°çš„çª—å£, å¹¶ä¸”å½“æ°´å°é€šè¿‡12:06çš„æ—¶é—´æˆ³çš„æ—¶å€™, å°†ä¼šåˆ é™¤</p>
</blockquote>
<p>in addition, each window will have a Trigger (see <a target="_blank" rel="noopener" href="https://nightlies.apache.org/flink/flink-docs-release-1.13/zh/docs/dev/datastream/operators/windows/#triggers">Trigger</a>) and a function(ProcessWindowFunction, ReduceFunction, Or AggregateFunction)(see <a target="_blank" rel="noopener" href="https://nightlies.apache.org/flink/flink-docs-release-1.13/zh/docs/dev/datastream/operators/windows/#window-functions">Window Functions</a>) attached to it, The function will contain the computation to be applied to the contents of the window , while the Trigger specifies the condition of the windwo , window is considered ready for the function to be applied. A triggering policy might be something like â€œwhen the number of elements in the window is more than 4â€, or â€œwhen the watermark passes the end of the windowâ€. A trigger can also decide to purge a windowâ€™s contents any time between its creation and removal , Purging in this case only refers to the elements in the window, and not the window metadata. This means that new data can still be added to that window.</p>
<blockquote>
<p>æ­¤å¤–, æ¯ä¸€ä¸ªçª—å£éƒ½ä¼šæœ‰ä¸€ä¸ªè§¦å‘å™¨å’Œä¸€ä¸ªå‡½æ•°(ProcessWindowFunction,ReduceFunctionæˆ–åˆ™AggregateFunction)é™„åŠ åˆ°å®ƒ. è¯¥å‡½æ•°å°†åŒ…å«åº”ç”¨äºçª—å£å†…å®¹çš„è®¡ç®—, è€Œè§¦å‘å™¨åˆ™æŒ‡å®šçª—å£è¢«è®¤ä¸ºæœ±å®‰å¤‡å¥½åº”ç”¨è¯¥å‡½æ•°çš„æ¡ä»¶. è§¦å‘ç­–ç•¥å¯èƒ½æ˜¯â€å½“çª—å£ä¸­çš„å…ƒç´ æ•°é‡è¶…è¿‡4â€æˆ–è€…â€å½“æ°´å°é€šè¿‡çª—å£çš„æœ«ç«¯çš„æ—¶å€™â€. è§¦å‘å™¨ä¹Ÿå¯ä»¥å†³å®šçª—å£åˆ›å»ºå’Œåˆ é™¤ä¹‹é—´çš„ä»»ä½•æ—¶é—´æ¸…é™¤å…¶ä¸­çš„å†…å®¹. åœ¨è¿™ç§æƒ…å†µä¸‹, æ¸…é™¤åªæŒ‡çª—å£ä¸­çš„å…ƒç´ , è€Œä¸æ˜¯çª—å£çš„å…ƒæ•°æ®. è¿™æ„å‘³ç€, æ–°çš„æ•°æ®ä»ç„¶å¯ä»¥è¢«æ·»åŠ åˆ°è¯¥çª—å£.</p>
</blockquote>
<p>Apart from the above , you can specify an Evictor(see <a target="_blank" rel="noopener" href="https://nightlies.apache.org/flink/flink-docs-release-1.13/zh/docs/dev/datastream/operators/windows/#evictors">Evictor</a>) which will be able to remove elements from the window after the trigger fires and before and/or after the function is applied.</p>
<p>In the following we go into more deetail for each of the components above. We start with the required parts in the above snippet(see <a target="_blank" rel="noopener" href="https://nightlies.apache.org/flink/flink-docs-release-1.13/zh/docs/dev/datastream/operators/windows/#keyed-vs-non-keyed-windows">Keyed vs Non-Keyed Windows</a>, <a target="_blank" rel="noopener" href="https://nightlies.apache.org/flink/flink-docs-release-1.13/zh/docs/dev/datastream/operators/windows/#window-assigner">Windwo Assigner</a>, and <a target="_blank" rel="noopener" href="https://nightlies.apache.org/flink/flink-docs-release-1.13/zh/docs/dev/datastream/operators/windows/#window-function">Window Function</a>)before moving to the optional ones.</p>
<blockquote>
<p>é™¤äº†ä¸Šé¢çš„è¿™äº›, ä½ è¿˜å¯ä»¥æŒ‡å®šä¸€ä¸ªEvictor, ä»–å°†èƒ½å¤Ÿåœ¨è§¦å‘å™¨å‡ºå‘ä¹‹å, åœ¨å‡½æ•°åº”ç”¨ä¹‹å‰å’Œ/æˆ–è€…ä¹‹åä»çª—å£ä¸­ç§»é™¤å…ƒç´ .</p>
<p>åœ¨ä¸‹æ–‡ä¸­, æˆ‘ä»¬å°†ä¼šå¯¹ä¸Šè¿°çš„ç»„ä»¶è¿›è¡Œæ›´åŠ è¯¦ç»†çš„è®¨è®º, æˆ‘ä»¬ä»ä¸Šè¿°ç‰‡æ®µä¸­çš„å¿…è¦éƒ¨åˆ†å¼€å§‹, ç„¶åå†è½¬åˆ°å¯é€‰éƒ¨åˆ†</p>
</blockquote>
<h1 id="çª—å£ç±»å‹"><a href="#çª—å£ç±»å‹" class="headerlink" title="çª—å£ç±»å‹"></a>çª—å£ç±»å‹</h1><ul>
<li><p>æ—¶é—´çª—å£</p>
<p>:one:æ»šåŠ¨æ—¶é—´çª—å£</p>
<p>:two:æ»‘åŠ¨æ—¶é—´çª—å£</p>
<p>:three:ä¼šè¯çª—å£</p>
</li>
<li><p>è®¡æ•°çª—å£</p>
<p>:one:æ»šåŠ¨è®¡æ•°çª—å£</p>
<p>:two:æ»‘åŠ¨æŠ€æœ¯çª—å£</p>
</li>
</ul>
<h1 id="æ»šåŠ¨çª—å£"><a href="#æ»šåŠ¨çª—å£" class="headerlink" title="æ»šåŠ¨çª—å£"></a>æ»šåŠ¨çª—å£</h1><p>A tumbing windows assigner assigns each element to a window of sprcified window size. Tubming windows have a fixed size and do not overlap. For example, if you specify a tumbling window with a size of 5 minutes, the current window will be evaluated and a new window will be  started every five minutes as illisrated by the following figure.</p>
<blockquote>
<p>æ»šåŠ¨çª—å£åˆ†é…å™¨å°†æ¯ä¸ªå…ƒç´ åˆ†é…åˆ°ä¸€ä¸ªæŒ‡å®šçª—å£å¤§å°çš„çª—å£. æ»šåŠ¨çª—å£æœ‰ä¸€ä¸ªå›ºå®šçš„å°ºå¯¸, å¹¶ä¸”ä¸é‡å . ä¾‹å¦‚, å¦‚æœä½ æŒ‡å®šä¸€ä¸ªå¤§å°ä¸º5åˆ†é’Ÿçš„æ»šåŠ¨çª—å£, å½“å‰çš„çª—å£å°†ä¼šè¢«è¯„ä¼°, å¹¶ä¸”æ¯5åˆ†é’Ÿå¼€å§‹ä¸€ä¸ªæ–°çš„çª—å£. å¦‚ä¸‹å›¾æ‰€ç¤º.</p>
</blockquote>
<p><strong>:red_circle:Flinkçª—å£æ˜¯å·¦é—­å³å¼€çš„, ä¾‹å¦‚0-5sæœ€åä¸€ä¸ªæ—¶é—´æˆ³æ˜¯4999â€‹</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/quietCC/imageBed/img/tumbling-windows.svg"></p>
<pre class="mermaid">graph LR
    A[æ•°æ®æµ]
    subgraph "key1-window-[0~5]"
        F[key2-event] --> G[key2-event]
    end
    subgraph "key1-window-[0~5]"
        D[key1-event] --> E[key1-event]
    end

    A --> F
    A --> D</pre>

<h1 id="æ»‘åŠ¨çª—å£"><a href="#æ»‘åŠ¨çª—å£" class="headerlink" title="æ»‘åŠ¨çª—å£"></a>æ»‘åŠ¨çª—å£</h1></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="mailto:undefined">æŠšä»Šäºº</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="http://example.com/2010/12/12/Flink-Windows%E5%87%BD%E6%95%B0/">http://example.com/2010/12/12/Flink-Windows%E5%87%BD%E6%95%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="http://example.com" target="_blank">æŠšä»Šäºº</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Flink/">Flink</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/quietCC/imageBed/img/613932.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2010/12/12/Flink-Watermark/"><img class="prev-cover" src="https://cdn.jsdelivr.net/gh/quietCC/imageBed/img/613932.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">Flink-Watermark</div></div></a></div><div class="next-post pull-right"><a href="/2010/12/12/Git/"><img class="next-cover" src="https://cdn.jsdelivr.net/gh/quietCC/imageBed/img/902224.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">Git</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/2010/12/12/Flink-CEP/" title="Flink-CEP"><img class="cover" src="https://cdn.jsdelivr.net/gh/quietCC/imageBed/img/613932.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2010-12-12</div><div class="title">Flink-CEP</div></div></a></div><div><a href="/2010/12/12/Flink-DataStreamæµå¤„ç†ç®—å­/" title="Flink-DataStreamæµå¤„ç†ç®—å­"><img class="cover" src="https://cdn.jsdelivr.net/gh/quietCC/imageBed/img/613932.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2010-12-12</div><div class="title">Flink-DataStreamæµå¤„ç†ç®—å­</div></div></a></div><div><a href="/2010/12/12/Flink-Watermark/" title="Flink-Watermark"><img class="cover" src="https://cdn.jsdelivr.net/gh/quietCC/imageBed/img/613932.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2010-12-12</div><div class="title">Flink-Watermark</div></div></a></div><div><a href="/2010/12/12/Flink-ä»‹ç»ä¸æ¶æ„/" title="Flink-ä»‹ç»ä¸æ¶æ„"><img class="cover" src="https://cdn.jsdelivr.net/gh/quietCC/imageBed/img/613932.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2010-12-12</div><div class="title">Flink-ä»‹ç»ä¸æ¶æ„</div></div></a></div><div><a href="/2010/12/12/Interview-Flink/" title="Interview-FLink"><img class="cover" src="https://cdn.jsdelivr.net/gh/quietCC/imageBed/img/613932.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2010-12-12</div><div class="title">Interview-FLink</div></div></a></div><div><a href="/2010/12/12/Flink-çŸ¥è¯†ç‚¹/" title="Flink-çŸ¥è¯†ç‚¹"><img class="cover" src="https://cdn.jsdelivr.net/gh/quietCC/imageBed/img/613932.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2010-12-12</div><div class="title">Flink-çŸ¥è¯†ç‚¹</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">æŠšä»Šäºº</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">49</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">36</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">8</div></a></div></div><a class="button--animated" id="card-info-btn" href="2010/12/12/hello-world/"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="tencent://message/?uin=2802849807&amp;Site=&amp;Menu=yes" target="_blank" title="QQ"><i class="iconfont icon-weixin"></i></a><a class="social-icon" href="https://blog.csdn.net/qq_33274506" target="_blank" title="CSDN"><i class="iconfont icon-csdn"></i></a><a class="social-icon" href="https://www.cnblogs.com/muyuqingchenyo/" target="_blank" title="cnblogs"><i class="iconfont icon-cnblogs"></i></a><a class="social-icon" href="https://space.bilibili.com/64912455" target="_blank" title="Bilibili"><i class="iconfont icon-bilibili"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>å…¬å‘Š</span></div><div class="announcement_content">ğŸˆçŸ¥é“çš„è¶Šå¤š, ä¸çŸ¥é“çš„è¶Šå¤š<br/>âœ¨ç¬¨é¸Ÿå…ˆé£<br/>ğŸ¨ç»ˆèº«å­¦ä¹ è€…<br/>ğŸæ‘¸é±¼çˆ±å¥½è€…<div class="twopeople"><div class="twopeople"><div class="container"style="height:200px;"><canvas class="illo"width="800"height="800"style="max-width: 200px; max-height: 200px; touch-action: none; width: 640px; height: 640px;"></canvas></div><script src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/js/twopeople1.js"></script><script src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/js/zdog.dist.js"></script><script id="rendered-js"src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/js/twopeople.js"></script><style>.twopeople{margin:0;align-items:center;justify-content:center;text-align:center}canvas{display:block;margin:0 auto;cursor:move}</style></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">ä»‹ç»</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">2.</span> <span class="toc-text">ç”Ÿå‘½å‘¨æœŸ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.</span> <span class="toc-text">çª—å£ç±»å‹</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%BB%9A%E5%8A%A8%E7%AA%97%E5%8F%A3"><span class="toc-number">4.</span> <span class="toc-text">æ»šåŠ¨çª—å£</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3"><span class="toc-number">5.</span> <span class="toc-text">æ»‘åŠ¨çª—å£</span></a></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdelivr.net/gh/quietCC/imageBed/img/613932.png')"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2021  <i id="heartbeat" class="fa fas fa-heartbeat"></i> æŠšä»Šäºº</div><div class="footer_custom_text"><p><a style="margin-inline:5px"target="_blank" href="https://hexo.io/"><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="åšå®¢æ¡†æ¶ä¸º Hexo" alt="HEXO"></a><a style="margin-inline:5px"target="_blank" href="https://butterfly.js.org/"><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender" title="ä¸»é¢˜é‡‡ç”¨ Butterfly" alt="Butterfly"></a><a style="margin-inline:5px"target="_blank" href="https://www.jsdelivr.com/"><img src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&logo=jsDelivr" title="æœ¬ç«™ä½¿ç”¨ Jsdelivr ä¸ºé™æ€èµ„æºæä¾›CDNåŠ é€Ÿ" alt="Jsdelivr"></a><a style="margin-inline:5px"target="_blank" href="https://github.com/"><img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="æœ¬ç«™é¡¹ç›®ç”± GitHub æ‰˜ç®¡" alt="GitHub"></a><a style="margin-inline:5px"target="_blank"href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" alt="img" title="æœ¬ç«™é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«4.0å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯"></a></p></div></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">æœ¬åœ°æœç´¢</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'butterfly',
      })
      true && mermaid.init()
    })
  }
}</script><script>function loadValine () {
  function initValine () {
    let initData = {
      el: '#vcomment',
      appId: 'rrVhJYSSgni6hMF1byozPOk3-gzGzoHsz',
      appKey: 'ktwsF7iCBxM5tJTJ8VXh3aeO',
      placeholder: 'è®°å¾—ç•™ä¸‹ä½ çš„æ˜µç§°å’Œé‚®ç®±....å¯ä»¥å¿«é€Ÿæ”¶åˆ°å›å¤',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
    }

    if (true) { 
      initData.requiredFields= ('nick,mail'.split(','))
    }
    
    if (false) {
      const otherData = false
      initData = Object.assign(initData, otherData)
    }
    
    const valine = new Valine(initData)
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script src="https://myhkw.cn/api/player/157888126354" id="myhk" key="157888126354" m="1"></script><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  if (typeof gtag === 'function') {
    gtag('config', '', {'page_path': window.location.pathname});
  }

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})


document.addEventListener('pjax:send', function () {
  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>